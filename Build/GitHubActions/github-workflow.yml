# This is a basic workflow to help you get started with Actions

name: SSDT-Build

# Set environment variables for all the jobs
env:
  configuration: release
  sqlinstance: localhost
  database: UnitTesting
  artifactname: Database

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    # The type of runner that the job will run on
    runs-on: windows-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2


    # Adds MSBuild to PATH on the agent
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v1.0.0

    # Create artifact directory
    - name: Create artifact directory
      run: mkdir artifact

    # Copy files to artifact directory
    - name: Copy artifact files
      run: |
        "Get-ChildItem -Path github.repository\${{env.database}}-Tests\bin\$configuration"
        "copy ${{env.database}}-Tests\bin\$configuration\*.* artifact"
        "copy ${{env.database}}-Data\*.publish.xml artifact"
        "copy ${{env.database}}-Tests\*.publish.xml artifact"

    # Upload all the artifact files
    - name:  Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        # Artifact name
        name: ${{env.artifactname}}
        # Directory containing files to upload
        path: "artifact"
